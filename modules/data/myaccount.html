<section id=form_container__ID>
	<div id=header__ID>
		My Account
	</div>
	<form id=F__ID>
		<div class="container">
			<div class="row row__ID">
				<div class=col>
					<span>Email</span>
					<input type="text" class="form-control" name=Email readonly>
				</div>
			</div>
			<div class="row row__ID">
				<div class=col>
					<span>First name</span>
					<input type="text" class="form-control" name=First_name>
				</div>
			</div>
            <div class="row row__ID">
				<div class=col>
					<span>Last name</span>
					<input type="text" class="form-control" name=Last_name>
				</div>
			</div>
            <div class="row row__ID">
				<div class=col>
					<span>Username</span>
					<input type="text" class="form-control" name=Username readonly>
				</div>
			</div>
            <div class="row row__ID">
				<div class=col>
					<span>Password</span>
					<input type="password" class="form-control" name=Password>
				</div>
			</div>
			<br>
			<div class="row">
				<div class=col>
					<button id=submit__ID type="submit" class="btn btn-secondary">Submit</button>
				</div>
			</div>
		</div>
	</form>
</section>
<script>
	function F__ID(){
        //-------------------------------------
        if($vm.module==undefined) $vm.module={};
        $vm.module["__ID"]={};
        var m=$vm.module["__ID"];
        m.name=$vm.vm['__ID'].name;
        m.input=$vm.vm['__ID'].input; if(m.input==undefined) m.input={};
        m.module=$vm.module_list[m.name];
        m.preload=m.module.preload;
        m.prefix=m.module.prefix; if(m.prefix==undefined) m.prefix="";
        m.form_module=m.prefix+m.module.form_module;
        m.db_pid=m.module.table_id;
        m.qid=m.module.qid; if(m.qid==undefined) m.qid=$vm.qid;
        //-------------------------------------
        m.load=function(){
            m.input=$vm.vm['__ID'].input; if(m.input==undefined) m.input={};
            $('#F__ID')[0].reset();
            $('#submit__ID').show();
            var grid_record=m.input.record;
            $('#delete__ID').hide(); if(grid_record!=undefined && grid_record._id!==undefined) $('#delete__ID').show();
            $vm.deserialize(grid_record,'#F__ID');
        }
        //-------------------------------
        m.submit=function(event){
            //--------------------------------------------------------
            event.preventDefault();
            $('#submit__ID').hide();
            //--------------------------------------------------------
            var data=$vm.serialize('#F__ID');
            var file=$vm.serialize_file('#F__ID');
            var FN=0; $('#F__ID').find('input[type=file]').each(function(evt){ if(this.files.length==1) FN++; });
            var dbv={}
            var r=true;
            if(m.before_submit!=undefined) r=m.before_submit(data,dbv);
            if(r==false){$('#submit__ID').show(); return;}
            //--------------------------------------------------------
            var rid=undefined; if(m.input.record!=undefined) rid=m.input.record._id;
            if(rid==undefined){
                var record={App:m.module.App,Table:m.module.Table,Data:data,File:file}
                $vm.request({cmd:"insert",record:record},function(res){
                    var after_submit=function(){
                        if(m.after_insert!=undefined){
                            m.after_insert(record,res); return;
                        }
                        $vm.refresh=1;
                        if(m.input.goback!=undefined) window.history.go(-1);       //from grid
                        else $vm.alert('Your data has been successfully submitted');    //standalone
                    }
                    after_submit();
                });
            }
            else if(rid!=undefined){
                var record={_id:rid,App:m.module.App,Table:m.module.Table,UID:m.input.record.UID,Data:data,File:file}
                $vm.request({cmd:"update",record:record},function(res){
                    //-----------------------------
                    var after_submit=function(){
                        if(m.after_update!=undefined){
                            m.after_modify(record,res); return;
                        }
                        $vm.refresh=1;
                        if(rid!=undefined) window.history.go(-1);                       //modify
                    }
                    //-----------------------------
                    if(FN==0) after_submit();
                    else{
                        open_model__ID();
                        $vm.upload_form_files(res,$('#F__ID'),"msg__ID",function(){
                            close_model__ID();
                            after_submit();
                        })
                    }
                    //-----------------------------
                });
            }
        }
        //--------------------------------------------------------
        $('#D__ID').on('load',function(){ m.load();})
        $('#F__ID').submit(function(event){m.submit(event);})
        //--------------------------------------------------------
        $('#delete__ID').on('click', function(){
            var record=m.input.record;
            if(record==undefined) return;
            var rid=record._id;
            if(rid==undefined){
                return;
            }
            if(confirm("Are you sure to delete?\n")){
                var req={cmd:"delete",qid:m.qid,db_pid:m.db_pid,rid:rid,dbv:{}};
                $VmAPI.request({data:req,callback:function(res){
                    //-------------------------------
                    if(res.Error!==undefined) return false;
                    if(res.ret=='NULL'){
                        if(res.msg!==undefined) alert(res.msg);
                        else alert("No permission!");
                        return false;
                    }
                    //-------------------------------
                    if(m.after_delete!==undefined)  m.after_delete(res);
                    //-------------------------------
                    $vm.refresh=1;
                    window.history.go(-1);
                }});
            }
        })
        //-------------------------------------
        $('#header__ID').on('click', function(event){
            if(event.ctrlKey){
                var x=document.getElementById("F__ID");
                var txt="";var nm0="";
                for (var i=0; i < x.length; i++) {
                    var nm=x.elements[i].getAttribute("name");
                    if(nm!=null && nm!=nm0){ if(txt!="") txt+=", "; txt+=nm; nm0=nm;}
                }
                //$vm.alert(txt);
                console.log(txt);
            }
        });
		//-------------------------------------
		m.before_submit=function(record,dbv){
			return true;
        };
        //-------------------------------------
	}
</script>
<style>
	#F__ID div span{
		display:inline-block;
		padding-bottom:5px;
	}
	#F__ID div label{
		display:inline-block;
	}
	#D__ID{
		height:100%;
		overflow:auto;
		animation: vm_module_fadein 1.0s;
		background-color:#fff;
	}
    #form_container__ID{
        margin-top:20px;
		max-width: 700px;
		margin-left: auto;
		margin-right: auto;

		font-family: Verdana,sans-serif;
    	font-size: 15px;
    	line-height: 1.5;
	}
	#form_container__ID .row__ID{
		padding:6px 5px;
	}
	#form_container__ID .row__ID:hover{
		background-color: #ddd;
	}
	#header__ID{
		background-color:#727b84;
		color:#fff;
		padding:10px 15px 10px 15px;
		font-size:120%;
        border:1px solid #bbb;
        border-bottom-width: 0;
	}
	#F__ID{
		border:1px solid #bbb;
        border-top-width: 0;
		padding:6px 15px 20px 15px;
		margin-bottom:200px;
	}
	#F__ID fieldset {
	    border: 0px solid #c0c0c0;
	    margin: 0;
	    padding: 0;
	}
	@media screen and (max-width:768px){
		#form_container__ID{
			padding:20px 10px 50px 10px;
		}
	}
    .C__ID {
        background-color: #ccc;
    }
</style>
